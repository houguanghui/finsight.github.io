import{w as H,a as u,t}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{f as w,S as U,R as I,C as a,c as X}from"./index-kAgd77-w.js";import{q as Z,S as _,R as D,d as ee,P as te}from"./Table-Bz-N3dAz.js";import{S as oe}from"./statsAnalysisService-CdRzj0rd.js";import{D as se}from"./request-CjBmveHj.js";import{D as z}from"./index-CeNonjvE.js";import{A as E}from"./index-Bs4fN4oH.js";import{C as x}from"./index-DFyzaV81.js";import{S as v,L as ne}from"./index-CQDSfuxM.js";import{P}from"./index-BLlS64GR.js";import{C as ie}from"./index-CybngSer.js";import{a as re}from"./index-CVy4ob4l.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./index-DsuPZzx1.js";import"./Pagination-BgtA34Dv.js";import"./index-jC90AlnQ.js";import"./index-_fd0fOh9.js";import"./index-B4RzsnZD.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./Table-4OPVbUbL.js";import"./Tree-CIH8SUTX.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./index-tUNJ2f8S.js";import"./useNotification-CCy-DdaB.js";import"./index-CRb9OZA9.js";import"./index-C38gChg6.js";import"./index-DhCLwE81.js";import"./EyeOutlined-BeRCIN0Q.js";import"./TextArea-CJq9T7-C.js";import"./callSuper-YXcpR1nQ.js";import"./index-DSKHKlRI.js";import"./AntdIcon-Dmy0igr9.js";w.extend(Z);const{RangePicker:le}=se,de=()=>{const[j,G]=u.useState(!1),[R,V]=u.useState(null),[y,F]=u.useState([w().subtract(15,"month"),w()]),[h,M]=u.useState(null),[[$,g,b],A]=u.useState(["sj","zb","A01030G"]),[p,O]=u.useState("momGrowthView"),[f,W]=u.useState("A01030G01"),T=e=>`${e.year()}${e.format("MM")}`,L=async()=>{G(!0),V(null);try{const[e]=await Promise.all([oe.getAnalysisData(`cpi_${b}_month`,{startTime:T(y[0]),endTime:T(y[1])})]);M(e)}catch(e){console.error("加载数据失败:",e),V(e instanceof Error?e.message:"数据加载失败")}finally{G(!1)}},k=()=>{if(!h)return[];const e=h.wdnodes.find(i=>i.wdcode==="zb");return(e==null?void 0:e.nodes)||[]},q=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes))return[];const i=e.wdnodes.find(n=>n.wdcode==$),s=e.wdnodes.find(n=>n.wdcode==g);if(!i||!s)return[];const r=[{title:s.wdname,dataIndex:s.wdcode,align:"left"}],o=i.nodes.map(n=>({title:n.cname,dataIndex:n.code,align:"center"}));return o.length>11?r.concat(o.slice(o.length-12)):r.concat(o)},K=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes)||!(e!=null&&e.hasdatacount))return[];const i=e.wdnodes.find(s=>s.wdcode===g);return i?i.nodes.map(s=>{var n;const r={[g]:((n=i.nodes.find(l=>l.code==s.code))==null?void 0:n.cname)||""};return e.datanodes.filter(l=>l.wds.some(d=>d.wdcode===g&&d.valuecode===s.code)).forEach(l=>{const d=l.wds.find(C=>C.wdcode===$);d&&(r[d.valuecode]=l.data.strdata)}),r}):[]},J=e=>{if(!(e!=null&&e.datanodes))return[];const i={};return e.datanodes.forEach(r=>{var l;const o=r.wds.find(d=>d.wdcode==="sj"),n=r.wds.find(d=>d.wdcode==="zb");if(o&&n){const d=o.valuecode;i[d]||(i[d]={time:d}),i[d][n.valuecode]=r.data.dataValue;const C=(l=e.wdnodes.find(S=>S.wdcode==="zb"))==null?void 0:l.nodes.find(S=>S.code===n.valuecode);C&&(i[d][`${n.valuecode}_name`]=C.cname)}}),Object.values(i).sort((r,o)=>r.time.localeCompare(o.time))},N=e=>{if(!e||e.length==0)return[];const i=e[0];let s=Object.keys(i).filter(o=>typeof i[o]=="number");return s=s.length>5?s.slice(0,5):s,e.flatMap(o=>s.map(n=>({time:o.time,value:o[n],name:o[`${n}_name`]})))},Q=e=>{if(!e||e.length==0)return[];const i=e[0];let s=Object.keys(i).filter(o=>typeof i[o]=="number");return e.flatMap(o=>s.map(n=>({time:o.time,value:o[n],name:o[`${n}_name`]})))},Y=e=>{if(p=="yoyGrowthView"&&e.length<5||e.length<2)return;const i=e.map((s,r)=>{const o=p=="yoyGrowthView"&&r>=4?e[r-4]:r>0&&p!=="yoyGrowthView"?e[r-1]:s,n={...s};return Object.keys(s).forEach(l=>{typeof s[l]=="number"&&(n[l]=(s[l]-o[l])/o[l]*100,n[`${l}_name`]=s[`${l}_name`])}),n});return p=="yoyGrowthView"?i.slice(3):i},B=k(),m=h?J(h):[],c=Y(m);return u.useEffect(()=>{L()},[y,b]),t.jsxs(re,{header:{title:"CPI分析"},extra:[t.jsx(le,{onChange:e=>F(e),picker:"month",style:{width:300},defaultValue:y},"date")],children:[t.jsx(z,{}),j&&t.jsxs("div",{style:{textAlign:"center",padding:40},children:[t.jsx(U,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:"GDP数据加载中..."})]}),R&&t.jsx(E,{message:"加载错误",description:R,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),!j&&!h&&t.jsx(E,{message:"暂无数据",description:"请选择查看其他时间节点数据",type:"info",showIcon:!0}),t.jsx(x,{style:{marginBottom:24},children:t.jsxs(I,{gutter:16,children:[t.jsxs(a,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"统计类型"}),t.jsx(_,{options:[{label:"CPI",value:"A0101"}],value:b,onChange:e=>{e=="A01030G"?A(["zb","sj",e]):A(["sj","zb",e])}})]}),t.jsxs(a,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"图表视图"}),t.jsx(_,{options:[{label:"环比分析",value:"momGrowthView"},{label:"同比分析",value:"yoyGrowthView"}],value:p,onChange:e=>O(e)})]}),B.length>0&&t.jsxs(a,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"选择指标"}),t.jsx(X,{value:f,onChange:W,style:{width:200,marginRight:16},loading:j,options:B.map(e=>({label:e.cname,value:e.code}))})]})]})}),!j&&h&&t.jsxs(t.Fragment,{children:[m.length>0&&t.jsxs(I,{gutter:16,style:{marginBottom:24},children:[t.jsx(a,{span:6,children:t.jsx(x,{children:t.jsx(v,{title:m[m.length-1][`${f}_name`],value:m[m.length-1][f],precision:2})})}),t.jsx(a,{span:6,children:t.jsx(x,{children:t.jsx(v,{title:m[m.length-1][`${f}_name`],value:c&&c[c.length-1][f],precision:2,valueStyle:{color:c&&c[c.length-1][f]>=0?"#3f8600":"#cf1322"},prefix:c&&c[c.length-1][f]>=0?t.jsx(D,{}):t.jsx(ee,{}),suffix:"%"})})}),t.jsx(a,{span:6,children:t.jsx(x,{children:t.jsx(v,{title:"数据期间",value:m.length,suffix:"个月"})})}),t.jsx(a,{span:6,children:t.jsx(x,{children:t.jsx(v,{title:"统计类型",value:"指数统计较上月情况"})})})]}),t.jsx(z,{}),m.length>0&&t.jsxs(I,{gutter:16,children:[t.jsx(a,{xs:24,lg:12,children:t.jsx(P,{title:`CPI走势分析(${p=="momGrowthView"?"环比":"同比"})`,headerBordered:!0,children:t.jsx(ne,{height:300,data:Q(c||[]),xField:"time",yField:"value",colorField:"name",shapeField:"smooth"})})}),t.jsx(a,{xs:24,lg:12,children:t.jsx(P,{title:`CPI对比分析(${p=="momGrowthView"?"环比":"同比"})`,headerBordered:!0,children:t.jsx(ie,{height:300,group:{padding:0},colorField:"name",data:N(c||[]),xField:"time",yField:"value"})})})]}),t.jsx(P,{title:"详细数据",style:{marginTop:24},headerBordered:!0,children:t.jsx(te,{columns:q(h),dataSource:K(h),pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},rowKey:g,search:!1})})]})]})},Ne=H(de);export{Ne as default};
