import{w as N,a as g,t}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{f as S,S as U,R as $,C as h,c as X}from"./index-kAgd77-w.js";import{q as Z,S as F,R as D,d as ee,P as te}from"./Table-Bz-N3dAz.js";import{S as oe}from"./statsAnalysisService-CdRzj0rd.js";import{D as se}from"./request-CjBmveHj.js";import{D as E}from"./index-CeNonjvE.js";import{A as z}from"./index-Bs4fN4oH.js";import{C as y}from"./index-DFyzaV81.js";import{S as b,L as ne}from"./index-CQDSfuxM.js";import{P as w}from"./index-BLlS64GR.js";import{P as re}from"./index-DPP3BEpb.js";import{C as ie}from"./index-CybngSer.js";import{a as le}from"./index-CVy4ob4l.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./index-DsuPZzx1.js";import"./Pagination-BgtA34Dv.js";import"./index-jC90AlnQ.js";import"./index-_fd0fOh9.js";import"./index-B4RzsnZD.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./Table-4OPVbUbL.js";import"./Tree-CIH8SUTX.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./index-tUNJ2f8S.js";import"./useNotification-CCy-DdaB.js";import"./index-CRb9OZA9.js";import"./index-C38gChg6.js";import"./index-DhCLwE81.js";import"./EyeOutlined-BeRCIN0Q.js";import"./TextArea-CJq9T7-C.js";import"./callSuper-YXcpR1nQ.js";import"./index-DSKHKlRI.js";import"./AntdIcon-Dmy0igr9.js";S.extend(Z);const{RangePicker:de}=se,ae={A0101:"常规统计",A0102:"不变价统计"},ce=()=>{const[v,P]=g.useState(!1),[C,W]=g.useState([S().subtract(6,"quarter"),S()]),[f,q]=g.useState(null),[[A,x,a],G]=g.useState(["zb","sj","A0102"]),[V,I]=g.useState(null),[m,O]=g.useState("priceView"),[p,R]=g.useState("A010201"),T=e=>{switch(e.quarter()){case 1:return`${e.year()}A`;case 2:return`${e.year()}B`;case 3:return`${e.year()}C`;case 4:return`${e.year()}D`;default:throw console.error("季度格式不正确",e.quarter()),new Error("季度格式不正确")}},M=async()=>{P(!0),I(null);try{const[e]=await Promise.all([oe.getAnalysisData(`gdp_${a}_quarter`,{startTime:T(C[0]),endTime:T(C[1])})]);q(e)}catch(e){console.error("加载数据失败:",e),I(e instanceof Error?e.message:"数据加载失败")}finally{P(!1)}},L=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes)||!(e!=null&&e.hasdatacount))return[];const o=e.wdnodes.find(s=>s.wdcode===x);return o?o.nodes.map(s=>{var l;const n={[x]:((l=o.nodes.find(r=>r.code==s.code))==null?void 0:l.cname)||""};return e.datanodes.filter(r=>r.wds.some(d=>d.wdcode===x&&d.valuecode===s.code)).forEach(r=>{const d=r.wds.find(j=>j.wdcode===A);d&&(n[d.valuecode]=r.data.strdata)}),n}):[]},K=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes))return[];const o=e.wdnodes.find(l=>l.wdcode==A),s=e.wdnodes.find(l=>l.wdcode==x);if(!o||!s)return[];const n=[{title:s.wdname,dataIndex:s.wdcode,align:"left"}],i=o.nodes.map(l=>({title:l.cname,dataIndex:l.code,align:"center"}));return i.length>8?n.concat(i.slice(i.length-8)):n.concat(i)},Q=e=>{if(!(e!=null&&e.datanodes))return[];const o={};return e.datanodes.forEach(s=>{var l;const n=s.wds.find(r=>r.wdcode==="sj"),i=s.wds.find(r=>r.wdcode==="zb");if(n&&i){const r=n.valuecode;o[r]||(o[r]={time:r}),o[r][i.valuecode]=s.data.dataValue;const d=(l=e.wdnodes.find(j=>j.wdcode==="zb"))==null?void 0:l.nodes.find(j=>j.code===i.valuecode);d&&(o[r][`${i.valuecode}_name`]=d.cname)}}),Object.values(o).sort((s,n)=>s.time.localeCompare(n.time))},_=e=>e?e.flatMap(o=>[{time:o.time,value:o[`${a}03`],name:o[`${a}03_name`]},{time:o.time,value:o[`${a}05`],name:o[`${a}05_name`]},{time:o.time,value:o[`${a}07`],name:o[`${a}07_name`]}]):[],J=()=>{if(!f)return[];const e=f.wdnodes.find(o=>o.wdcode==="zb");return(e==null?void 0:e.nodes.filter(o=>o.code.startsWith(a)&&!o.code.endsWith("累计")&&!o.cname.includes("累计")))||[]},Y=(e,o)=>{if(m=="yoyGrowthView"&&e.length<5||e.length<2)return;const s=e.map((n,i)=>{const l=m=="yoyGrowthView"&&i>=4?e[i-4]:i>0&&m!=="yoyGrowthView"?e[i-1]:n,r={...n};return Object.keys(n).forEach(d=>{typeof n[d]=="number"&&(r[d]=(n[d]-l[d])/l[d]*100,r[`${d}_name`]=n[`${d}_name`])}),r});return m=="yoyGrowthView"?s.slice(3):s},k=e=>{if(e.length===0)return[];const o=e[e.length-1],s=o[`${a}03`]||0,n=o[`${a}05`]||0,i=o[`${a}07`]||0,l=s+n+i;return[{name:"第一产业",value:s,percentage:s/l*100},{name:"第二产业",value:n,percentage:n/l*100},{name:"第三产业",value:i,percentage:i/l*100}]},c=f?Q(f):[],B=J(),u=Y(c),H=k(c);return g.useEffect(()=>{M()},[C,a]),t.jsxs(le,{header:{title:"GDP分析"},extra:[t.jsx(de,{onChange:e=>W(e),picker:"quarter",style:{width:300},defaultValue:C},"date")],children:[t.jsx(E,{}),v&&t.jsxs("div",{style:{textAlign:"center",padding:40},children:[t.jsx(U,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:"GDP数据加载中..."})]}),V&&t.jsx(z,{message:"加载错误",description:V,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),!v&&!f&&t.jsx(z,{message:"暂无数据",description:"请选择查看其他时间节点数据",type:"info",showIcon:!0}),t.jsx(y,{style:{marginBottom:24},children:t.jsxs($,{gutter:16,children:[t.jsxs(h,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"统计类型"}),t.jsx(F,{options:[{label:"GDP",value:"A0101"},{label:"GDP不变价",value:"A0102"}],value:a,onChange:e=>{e=="A0102"?G(["zb","sj",e]):G(["sj","zb",e]),R(`${e}01`)}})]}),t.jsxs(h,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"图表视图"}),t.jsx(F,{options:[{label:"价格分析",value:"priceView"},{label:"同比分析",value:"yoyGrowthView"},{label:"环比分析",value:"momGrowthView"}],value:m,onChange:e=>O(e)})]}),B.length>0&&t.jsxs(h,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"选择指标"}),t.jsx(X,{value:p,onChange:R,style:{width:200,marginRight:16},loading:v,options:B.map(e=>({label:e.cname,value:e.code}))})]})]})}),!v&&f&&t.jsxs(t.Fragment,{children:[c.length>0&&t.jsxs($,{gutter:16,style:{marginBottom:24},children:[t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(b,{title:c[c.length-1][`${p}_name`],value:c[c.length-1][p],precision:2,suffix:"亿元"})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(b,{title:c[c.length-1][`${p}_name`],value:u&&u[u.length-1][p],precision:2,valueStyle:{color:u&&u[u.length-1][p]>=0?"#3f8600":"#cf1322"},prefix:u&&u[u.length-1][p]>=0?t.jsx(D,{}):t.jsx(ee,{}),suffix:"%"})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(b,{title:"数据期间",value:c.length,suffix:"个季度"})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(b,{title:"统计类型",value:ae[a]})})})]}),t.jsx(E,{}),c.length>0&&t.jsxs($,{gutter:16,children:[t.jsx(h,{xs:24,lg:8,children:t.jsx(w,{title:"GDP结构分析(价格)",headerBordered:!0,children:t.jsx(re,{height:300,data:H,angleField:"value",colorField:"name",label:{text:"value",style:{fontWeight:"bold"}}})})}),t.jsx(h,{xs:24,lg:8,children:t.jsx(w,{title:`GDP走势分析(${m=="priceView"?"价格":m=="momGrowthView"?"环比":"同比"})`,headerBordered:!0,children:t.jsx(ne,{height:300,data:m=="priceView"?c:u,xField:"time",yField:p,colorField:`${p}_name`,shapeField:"smooth"})})}),t.jsx(h,{xs:24,lg:8,children:t.jsx(w,{title:`GDP对比分析(${m=="priceView"?"价格":m=="momGrowthView"?"环比":"同比"})`,headerBordered:!0,children:t.jsx(ie,{height:300,group:{padding:0},colorField:"name",data:m=="priceView"?_(c):_(u||[]),xField:"time",yField:"value"})})})]}),t.jsx(w,{title:"详细数据",style:{marginTop:24},headerBordered:!0,children:t.jsx(te,{columns:K(f),dataSource:L(f),pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},rowKey:x,search:!1})})]})]})},Ne=N(ce);export{Ne as default};
