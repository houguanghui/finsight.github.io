import{w as Ae,a as c,t}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{f as $,S as be,R as w,C as m,c as ve}from"./index-kAgd77-w.js";import{q as Se,T as we,S as J,R as _e,d as Ce,P as Te}from"./Table-Bz-N3dAz.js";import{S as H}from"./statsAnalysisService-CdRzj0rd.js";import{D as Ge}from"./request-CjBmveHj.js";import{D as U}from"./index-CeNonjvE.js";import{A as X}from"./index-Bs4fN4oH.js";import{C as A}from"./index-DFyzaV81.js";import{S as _,L as Z}from"./index-CQDSfuxM.js";import{P as C}from"./index-BLlS64GR.js";import{C as Me}from"./index-CybngSer.js";import{a as Ie}from"./index-CVy4ob4l.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./index-DsuPZzx1.js";import"./Pagination-BgtA34Dv.js";import"./index-jC90AlnQ.js";import"./index-_fd0fOh9.js";import"./index-B4RzsnZD.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./Table-4OPVbUbL.js";import"./Tree-CIH8SUTX.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./index-tUNJ2f8S.js";import"./useNotification-CCy-DdaB.js";import"./index-CRb9OZA9.js";import"./index-C38gChg6.js";import"./index-DhCLwE81.js";import"./EyeOutlined-BeRCIN0Q.js";import"./TextArea-CJq9T7-C.js";import"./callSuper-YXcpR1nQ.js";import"./index-DSKHKlRI.js";import"./AntdIcon-Dmy0igr9.js";$.extend(Se);const{RangePicker:Pe}=Ge,{Title:gt}=we,Ve=()=>{const[b,q]=c.useState(!1),[D,R]=c.useState(null),[g,k]=c.useState([$().subtract(5,"year"),$()]),[y,ee]=c.useState(null),[$e,B]=c.useState(null),[te,se]=c.useState(null),[[E,x,u],re]=c.useState(["zb","sj","hbgy_A0D01_month"]),[h,oe]=c.useState("absoluteView"),[p,T]=c.useState("A0D0101"),[a,ne]=c.useState("money_supply"),[G,M]=c.useState("year"),F={A0D0101:"货币和准货币(M2)",A0D0102:"货币(M1)",A0D0103:"流通中现金(M0)",A0D0104:"活期存款",A0D0105:"准货币",A0D0106:"定期存款",A0D0107:"储蓄存款",A0D0108:"其他存款"},ie={A020101:"国内生产总值",A020102:"第一产业",A020103:"第二产业",A020104:"第三产业",A020105:"人均国内生产总值"},ae={A010201:"国内生产总值",A010202:"第一产业",A010203:"第二产业",A010204:"第三产业",A010205:"农林牧渔业",A010206:"工业",A010207:"建筑业",A010208:"批发和零售业",A010209:"交通运输、仓储和邮政业",A010210:"住宿和餐饮业",A010211:"金融业",A010212:"房地产业",A010213:"信息传输、软件和信息技术服务业",A010214:"租赁和商务服务业",A010215:"其他行业"},le=()=>G==="year"?ie:ae,z=e=>`${e.year()}${e.format("MM")}`,I=e=>`${e.year()}`,de=e=>{switch(e.quarter()){case 1:return`${e.year()}A`;case 2:return`${e.year()}B`;case 3:return`${e.year()}C`;case 4:return`${e.year()}D`;default:throw console.error("季度格式不正确",e.quarter()),new Error("季度格式不正确")}},ce=e=>e.includes("month")?"month":e.includes("quarter")?"quarter":e.includes("year")?"year":"month",W=(e,s)=>s.includes("month")?z(e):s.includes("quarter")?de(e):s.includes("year")?I(e):z(e),ue=async()=>{q(!0),R(null);try{const[e,s]=await Promise.all([H.getAnalysisData(u,{startTime:W(g[0],u),endTime:W(g[1],u)}),a==="money_supply"?H.getAnalysisData("gdp_A0201_year",{startTime:I(g[0]),endTime:I(g[1])}):Promise.resolve(null)]);if(ee(e),se(s),a==="money_supply"&&e&&e.datanodes){const o=e.datanodes.filter(r=>r.wds.some(i=>i.wdcode==="zb"&&i.valuecode==="A0D0101"));B({...e,datanodes:o})}else B(null)}catch(e){console.error("加载数据失败:",e),R(e instanceof Error?e.message:"数据加载失败")}finally{q(!1)}},me=()=>{if(!y)return[];const e=y.wdnodes.find(s=>s.wdcode==="zb");return(e==null?void 0:e.nodes)||[]},O=e=>e?a==="money_supply"?F[e]||e:le()[e]||e:"",pe=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes))return[];const s=e.wdnodes.find(n=>n.wdcode===E),o=e.wdnodes.find(n=>n.wdcode===x);if(!s||!o)return[];const r=[{title:o.wdname,dataIndex:o.wdcode,align:"left"}],i=s.nodes.map(n=>({title:n.cname,dataIndex:n.code,align:"center",render:l=>l?Number(l).toLocaleString():"-"}));return i.length>12?r.concat(i.slice(i.length-12)):r.concat(i)},ye=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes)||!(e!=null&&e.hasdatacount))return[];const s=e.wdnodes.find(o=>o.wdcode===x);return s?s.nodes.map(o=>{var n;const r={[x]:((n=s.nodes.find(l=>l.code===o.code))==null?void 0:n.cname)||""};return e.datanodes.filter(l=>l.wds.some(d=>d.wdcode===x&&d.valuecode===o.code)).forEach(l=>{const d=l.wds.find(P=>P.wdcode===E);d&&(r[d.valuecode]=l.data.strdata)}),r}):[]},he=e=>{if(!(e!=null&&e.datanodes))return[];const s={};return e.datanodes.forEach(r=>{var l;const i=r.wds.find(d=>d.wdcode==="sj"),n=r.wds.find(d=>d.wdcode==="zb");if(i&&n){const d=i.valuecode;s[d]||(s[d]={time:d});const P=a==="money_supply"?r.data.dataValue/1e4:r.data.dataValue;s[d][n.valuecode]=P;const N=(l=e.wdnodes.find(V=>V.wdcode==="zb"))==null?void 0:l.nodes.find(V=>V.code===n.valuecode);N&&(s[d][`${n.valuecode}_name`]=N.cname)}}),Object.values(s).sort((r,i)=>r.time.localeCompare(i.time))},fe=(e,s)=>{if(a!=="money_supply"||!e.length||!(s!=null&&s.datanodes))return[];const o={};return s.datanodes.forEach(r=>{const i=r.wds.find(l=>l.wdcode==="sj"),n=r.wds.find(l=>l.wdcode==="zb");i&&n&&n.valuecode==="A020101"&&(o[i.valuecode]=r.data.dataValue/1e8)}),e.filter(r=>r.time.substring(0,4)in o).map(r=>{const i=r.time.substring(0,4);return{time:r.time,ratio:r.A0D0101/o[i]*100}})},ge=e=>{if(a!=="money_supply"||!e.length)return[];const s=["A0D0102","A0D0105"];return e.flatMap(o=>s.map(r=>({time:o.time,value:o[r],category:F[r]||r})))},xe=e=>e.length<2?[]:e.map((s,o)=>{if(o===0)return{...s};let r;a==="money_supply"?r=h==="yoyGrowthView"&&o>=12?e[o-12]:e[o-1]:r=(h==="yoyGrowthView"||!(G==="quarter"))&&o>=4?e[o-4]:o>0?e[o-1]:s;const i={time:s.time};return Object.keys(s).forEach(n=>{typeof s[n]=="number"&&typeof r[n]=="number"&&(i[n]=(s[n]-r[n])/r[n]*100,i[`${n}_name`]=s[`${n}_name`])}),i}).filter(s=>Object.keys(s).length>1),Q=me(),v=y?he(y):[],f=xe(v),j=h==="absoluteView"?v:f,S=fe(v,te),L=ge(v),K=S.length>0,Y=L.length>0;c.useEffect(()=>{ue()},[g,u,a]),c.useEffect(()=>{if(a==="money_supply")T("A0D0101"),M("year");else if(a==="gdp"){const e=u.includes("quarter")?"quarter":"year";M(e),T(e==="year"?"A020101":"A010201")}},[a,u]);const je=e=>{re(["zb","sj",e]);const s=e.includes("hbgy")?"money_supply":"gdp";if(ne(s),s==="gdp"){const o=e.includes("quarter")?"quarter":"year";M(o)}};return t.jsxs(Ie,{header:{title:a==="money_supply"?"货币供应量分析":"GDP分析",extra:[t.jsx(Pe,{onChange:e=>k(e),picker:ce(u),style:{width:300},value:g},"date")]},children:[t.jsx(U,{}),b&&t.jsxs("div",{style:{textAlign:"center",padding:40},children:[t.jsx(be,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:"数据加载中..."})]}),D&&t.jsx(X,{message:"加载错误",description:D,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),!b&&!y&&t.jsx(X,{message:"暂无数据",description:"请选择查看其他时间节点数据",type:"info",showIcon:!0}),t.jsx(A,{style:{marginBottom:24},children:t.jsxs(w,{gutter:16,children:[t.jsxs(m,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"统计类型"}),t.jsx(J,{options:[{label:"货币供应量月度",value:"hbgy_A0D01_month"},{label:"GDP年度",value:"gdp_A0201_year"},{label:"GDP季度",value:"gdp_A0102_quarter"}],value:u,onChange:je})]}),t.jsxs(m,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"图表视图"}),t.jsx(J,{options:[{label:"绝对值",value:"absoluteView"},{label:"同比",value:"yoyGrowthView"},...a==="money_supply"||G==="quarter"?[{label:"环比",value:"momGrowthView"}]:[]],value:h,onChange:e=>oe(e)})]}),Q.length>0&&t.jsxs(m,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"选择指标"}),t.jsx(ve,{value:p,onChange:T,style:{width:200},loading:b,options:Q.map(e=>({label:e.cname,value:e.code}))})]})]})}),!b&&y&&t.jsxs(t.Fragment,{children:[j.length>0&&p&&t.jsxs(w,{gutter:16,style:{marginBottom:24},children:[t.jsx(m,{span:6,children:t.jsx(A,{children:t.jsx(_,{title:O(p),value:j[j.length-1][p],precision:h==="absoluteView"?2:1,suffix:h==="absoluteView"?a==="money_supply"?"万亿元":"亿元":"%"})})}),f.length>0&&t.jsx(m,{span:6,children:t.jsx(A,{children:t.jsx(_,{title:`较${h==="yoyGrowthView"?"上年同期":"上期"}变化`,value:f[f.length-1][p],precision:1,valueStyle:{color:f[f.length-1][p]>=0?"#3f8600":"#cf1322"},prefix:f[f.length-1][p]>=0?t.jsx(_e,{}):t.jsx(Ce,{}),suffix:"%"})})}),t.jsx(m,{span:6,children:t.jsx(A,{children:t.jsx(_,{title:"数据期间",value:j.length,suffix:u.includes("month")?"个月":u.includes("quarter")?"个季度":"年"})})}),a==="money_supply"&&K&&t.jsx(m,{span:6,children:t.jsx(A,{children:t.jsx(_,{title:"最新M2/GDP比率",value:S[S.length-1].ratio,precision:1,suffix:"%"})})})]}),t.jsx(U,{}),t.jsx(w,{gutter:16,style:{marginBottom:24},children:t.jsx(m,{span:24,children:t.jsx(C,{title:a==="money_supply"?"货币供应量趋势":"GDP趋势",headerBordered:!0,children:t.jsx(Z,{height:400,data:j.map(e=>({time:e.time,value:e[p||""],category:O(p)})),xField:"time",yField:"value",seriesField:"category",smooth:!0,yAxis:{label:{formatter:e=>`${e}${h==="absoluteView"?a==="money_supply"?"万亿元":"亿元":"%"}`}}})})})}),a==="money_supply"&&t.jsxs(w,{gutter:16,children:[Y&&t.jsx(m,{xs:24,lg:12,children:t.jsx(C,{title:"货币供应量结构",headerBordered:!0,children:t.jsx(Me,{height:300,isStack:!0,data:L,xField:"time",yField:"value",colorField:"category",legend:{position:"top"},yAxis:{label:{formatter:e=>`${e}万亿元`}}})})}),K&&t.jsx(m,{xs:24,lg:Y?12:24,children:t.jsx(C,{title:"M2/GDP比率",headerBordered:!0,children:t.jsx(Z,{height:300,data:S,xField:"time",yField:"ratio",yAxis:{label:{formatter:e=>`${e}%`}}})})})]}),t.jsx(C,{title:"详细数据",style:{marginTop:24},headerBordered:!0,children:t.jsx(Te,{columns:pe(y),dataSource:ye(y),pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},rowKey:x,search:!1,scroll:{x:"max-content"}})})]})]})},xt=Ae(Ve);export{xt as default};
