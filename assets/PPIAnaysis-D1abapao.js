import{w as U,a as f,t}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{f as S,S as X,R as b,C as h,c as Z}from"./index-kAgd77-w.js";import{q as D,S as G,R as ee,d as te,P as oe}from"./Table-Bz-N3dAz.js";import{S as se}from"./statsAnalysisService-CdRzj0rd.js";import{D as ne}from"./request-CjBmveHj.js";import{D as E}from"./index-CeNonjvE.js";import{A as M}from"./index-Bs4fN4oH.js";import{C as y}from"./index-DFyzaV81.js";import{S as C,L as ie}from"./index-CQDSfuxM.js";import{P}from"./index-BLlS64GR.js";import{C as re}from"./index-CybngSer.js";import{a as le}from"./index-CVy4ob4l.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./index-DsuPZzx1.js";import"./Pagination-BgtA34Dv.js";import"./index-jC90AlnQ.js";import"./index-_fd0fOh9.js";import"./index-B4RzsnZD.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./Table-4OPVbUbL.js";import"./Tree-CIH8SUTX.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./index-tUNJ2f8S.js";import"./useNotification-CCy-DdaB.js";import"./index-CRb9OZA9.js";import"./index-C38gChg6.js";import"./index-DhCLwE81.js";import"./EyeOutlined-BeRCIN0Q.js";import"./TextArea-CJq9T7-C.js";import"./callSuper-YXcpR1nQ.js";import"./index-DSKHKlRI.js";import"./AntdIcon-Dmy0igr9.js";S.extend(D);const{RangePicker:de}=ne,ce=()=>{const[v,I]=f.useState(!1),[R,w]=f.useState(null),[g,O]=f.useState([S().subtract(3,"year"),S()]),[u,z]=f.useState(null),[[T,x,p],W]=f.useState(["zb","sj","ppi_A010807_month"]),[j,L]=f.useState("momGrowthView"),[c,V]=f.useState(p=="ppi_A010807_month"?"A01080701":"A090105"),$=e=>`${e.year()}${e.format("MM")}`,B=e=>`${e.year()}`,k=async()=>{I(!0),w(null);try{const[e]=await Promise.all([se.getAnalysisData(p,{startTime:p=="ppi_A010807_month"?$(g[0]):B(g[0]),endTime:p=="ppi_A010807_month"?$(g[1]):B(g[1])})]);z(e)}catch(e){console.error("加载数据失败:",e),w(e instanceof Error?e.message:"数据加载失败")}finally{I(!1)}},q=()=>{if(!u)return[];const e=u.wdnodes.find(i=>i.wdcode==="zb");return(e==null?void 0:e.nodes)||[]},K=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes))return[];const i=e.wdnodes.find(n=>n.wdcode==T),s=e.wdnodes.find(n=>n.wdcode==x);if(!i||!s)return[];const r=[{title:s.wdname,dataIndex:s.wdcode,align:"left"}],o=i.nodes.map(n=>({title:n.cname,dataIndex:n.code,align:"center"}));return o.length>11?r.concat(o.slice(o.length-12)):r.concat(o)},Y=e=>{if(!(e!=null&&e.datanodes)||!(e!=null&&e.wdnodes)||!(e!=null&&e.hasdatacount))return[];const i=e.wdnodes.find(s=>s.wdcode===x);return i?i.nodes.map(s=>{var n;const r={[x]:((n=i.nodes.find(l=>l.code==s.code))==null?void 0:n.cname)||""};return e.datanodes.filter(l=>l.wds.some(d=>d.wdcode===x&&d.valuecode===s.code)).forEach(l=>{const d=l.wds.find(_=>_.wdcode===T);d&&(r[d.valuecode]=l.data.strdata)}),r}):[]},J=e=>{if(!(e!=null&&e.datanodes))return[];const i={};return e.datanodes.forEach(r=>{var l;const o=r.wds.find(d=>d.wdcode==="sj"),n=r.wds.find(d=>d.wdcode==="zb");if(o&&n){const d=o.valuecode;i[d]||(i[d]={time:d}),i[d][n.valuecode]=r.data.dataValue;const _=(l=e.wdnodes.find(A=>A.wdcode==="zb"))==null?void 0:l.nodes.find(A=>A.code===n.valuecode);_&&(i[d][`${n.valuecode}_name`]=_.cname)}}),Object.values(i).sort((r,o)=>r.time.localeCompare(o.time))},N=e=>{if(!e||e.length==0)return[];const i=e[0];let s=Object.keys(i).filter(o=>typeof i[o]=="number");return s=s.length>5?s.slice(0,5):s,e.flatMap(o=>s.map(n=>({time:o.time,value:o[n],name:o[`${n}_name`]})))},Q=e=>{if(!e||e.length==0)return[];const i=e[0];let s=Object.keys(i).filter(o=>typeof i[o]=="number");return e.flatMap(o=>s.map(n=>({time:o.time,value:o[n],name:o[`${n}_name`]})))},H=e=>{if(j=="yoyGrowthView"&&c=="ppi_A010807_month"&&e.length<5||e.length<2)return;const i=e.map((s,r)=>{const o=j=="yoyGrowthView"&&c=="ppi_A010807_month"&&r>=4?e[r-4]:r>0&&(j!=="yoyGrowthView"||c!=="ppi_A010807_month")?e[r-1]:s,n={...s};return Object.keys(s).forEach(l=>{typeof s[l]=="number"&&(n[l]=(s[l]-o[l])/o[l]*100,n[`${l}_name`]=s[`${l}_name`])}),n});return j=="yoyGrowthView"?i.slice(3):i},F=q(),m=u?J(u):[],a=H(m);return f.useEffect(()=>{k()},[g,p]),t.jsxs(le,{header:{title:"CPI分析"},extra:[t.jsx(de,{onChange:e=>O(e),picker:p=="ppi_A010807_month"?"month":"year",style:{width:300},defaultValue:g},"date")],children:[t.jsx(E,{}),v&&t.jsxs("div",{style:{textAlign:"center",padding:40},children:[t.jsx(X,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:"GDP数据加载中..."})]}),R&&t.jsx(M,{message:"加载错误",description:R,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),!v&&!u&&t.jsx(M,{message:"暂无数据",description:"请选择查看其他时间节点数据",type:"info",showIcon:!0}),t.jsx(y,{style:{marginBottom:24},children:t.jsxs(b,{gutter:16,children:[t.jsxs(h,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"统计类型"}),t.jsx(G,{options:[{label:"PPI月度",value:"ppi_A010807_month"},{label:"PPI年度",value:"ppi_A0901_year"}],value:p,onChange:e=>{W(["zb","sj",e]),V(e=="ppi_A010807_month"?"A01080701":"A090105")}})]}),t.jsx(h,{span:8,children:p=="ppi_A010807_month"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"图表视图"}),t.jsx(G,{options:[{label:"环比分析",value:"momGrowthView"},{label:"同比分析",value:"yoyGrowthView"}],value:j,onChange:e=>L(e)})]})}),F.length>0&&t.jsxs(h,{span:8,children:[t.jsx("div",{style:{marginBottom:8,fontWeight:"bold"},children:"选择指标"}),t.jsx(Z,{value:c,onChange:V,style:{width:200,marginRight:16},loading:v,options:F.map(e=>({label:e.cname,value:e.code}))})]})]})}),!v&&u&&t.jsxs(t.Fragment,{children:[m.length>0&&c&&t.jsxs(b,{gutter:16,style:{marginBottom:24},children:[t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(C,{title:m[m.length-1][`${c}_name`],value:m[m.length-1][c],precision:2})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(C,{title:m[m.length-1][`${c}_name`],value:a&&a[a.length-1][c],precision:2,valueStyle:{color:a&&a[a.length-1][c]>=0?"#3f8600":"#cf1322"},prefix:a&&a[a.length-1][c]>=0?t.jsx(ee,{}):t.jsx(te,{}),suffix:"%"})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(C,{title:"数据期间",value:m.length,suffix:p=="ppi_A010807_month"?"个月":"年"})})}),t.jsx(h,{span:6,children:t.jsx(y,{children:t.jsx(C,{title:"统计类型",value:"指数统计较上次情况"})})})]}),t.jsx(E,{}),m.length>0&&t.jsxs(b,{gutter:16,children:[t.jsx(h,{xs:24,lg:12,children:t.jsx(P,{title:"PPI走势分析",headerBordered:!0,children:t.jsx(ie,{height:300,data:Q(a||[]),xField:"time",yField:"value",colorField:"name",shapeField:"smooth"})})}),t.jsx(h,{xs:24,lg:12,children:t.jsx(P,{title:"PPI对比分析",headerBordered:!0,children:t.jsx(re,{height:300,group:{padding:0},colorField:"name",data:N(a||[]),xField:"time",yField:"value"})})})]}),t.jsx(P,{title:"详细数据",style:{marginTop:24},headerBordered:!0,children:t.jsx(oe,{columns:K(u),dataSource:Y(u),pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},rowKey:x,search:!1})})]})]})},Ne=U(ce);export{Ne as default};
