import{w as E,a as u,t as e}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{c as w,f as h,S as T,R as C,C as o}from"./index-kAgd77-w.js";import{h as z,D as Z}from"./request-CjBmveHj.js";import{C as I}from"./index-DFyzaV81.js";import{R as b}from"./index-_fd0fOh9.js";import{S as d,L as M}from"./index-CQDSfuxM.js";import{D as O}from"./index-CeNonjvE.js";import{C as V}from"./index-CybngSer.js";import{s as _}from"./index-tUNJ2f8S.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./index-B4RzsnZD.js";import"./callSuper-YXcpR1nQ.js";import"./useNotification-CCy-DdaB.js";const G="/api/stock-daily",R={getStockDailyData:async(g,m,x,f="3")=>await z.get(`${G}/code/${g}/date-range`,{startDate:m,endDate:x,adjustflag:f}),getStockList:async()=>[{code:"600000.SH",name:"浦发银行"},{code:"000001.SZ",name:"平安银行"},{code:"600036.SH",name:"招商银行"},{code:"601318.SH",name:"中国平安"},{code:"600519.SH",name:"贵州茅台"},{code:"000858.SZ",name:"五粮液"},{code:"000002.SZ",name:"万科A"},{code:"600016.SH",name:"民生银行"}]},{RangePicker:U}=Z,{Option:W}=w,q=()=>{const[g,m]=u.useState("600519.SH"),[x,f]=u.useState([h("2025-09-08").subtract(60,"day"),h("2025-09-08")]),[j,P]=u.useState("2"),[c,Y]=u.useState([]),[p,y]=u.useState(!1),[F,L]=u.useState([]),S=async()=>{var t,a;y(!0);try{const r=(t=x[0])==null?void 0:t.format("YYYY-MM-DD"),s=(a=x[1])==null?void 0:a.format("YYYY-MM-DD"),[l,n]=await Promise.all([R.getStockDailyData(g,r,s,j),R.getStockList()]);Y(l||[]),L(n)}catch(r){_.error(`数据获取失败: ${r.message}`)}finally{y(!1)}},v=t=>t.map(a=>({...a,date:a.date,pctChg:(a.close-a.open)/a.open,timestamp:new Date(a.date).getTime(),change:(a.close-a.open)/a.open,isRise:(a.close-a.open)/a.open>=0,volumeFormatted:a.volume/1e4})).sort((a,r)=>new Date(a.date).getTime()-new Date(r.date).getTime()),A={data:v(c),padding:"auto",xField:"date",yField:"close",tooltip:{title:{field:"date",valueFormatter:t=>h(t).format("YYYY年MM月DD日")},items:[{field:"close",name:"收盘价"}]},axis:{x:{labelFormatter:t=>h(t).format("MM-DD"),labelFilter:(t,a,r)=>{if(!r||r.length===0)return!1;const s=Math.floor(r.length/15);return a===r.length||s>0&&a%s===0}}},point:{size:3,shape:"circle"}},B={data:v(c),padding:"auto",xField:"date",yField:"volumeFormatted",style:{fill:({isRise:t})=>t?"#ef5350":"#26a69a"},axis:{x:{title:"日期",labelFormatter:t=>h(t).format("MM-DD"),labelFilter:(t,a,r)=>{if(!r||r.length===0)return!1;const s=Math.floor(r.length/8);return a===r.length||s>0&&a%s===0}},y:{title:"成交量(万股)",labelFormatter:t=>`${t.toFixed(0)}`}},tooltip:{title:{field:"date",valueFormatter:t=>h(t).format("YYYY年MM月DD日")},items:[{field:"volumeFormatted",name:"成交量",valueFormatter:t=>`${t.toFixed(0)}万股`}]}},H={data:(t=>{let a=!1;const r=t.map(n=>a&&n.isRise==!1?{date:n.date,type:"rising",pctChg:n.pctChg}:(a=n.isRise,{date:n.date,type:"rising",pctChg:n.isRise?n.pctChg:null}));a=!1;const s=t.map(n=>a&&n.isRise==!1?{date:n.date,type:"down",pctChg:n.pctChg}:{date:n.date,type:"down",pctChg:n.isRise?null:n.pctChg});return r.concat(s)})(v(c)),padding:"auto",xField:"date",yField:"pctChg",scale:{color:{range:["#ef5350","#26a69a"]}},colorField:"type",axis:{x:{title:"日期",labelFormatter:t=>h(t).format("MM-DD"),labelFilter:(t,a,r)=>{if(!r||r.length===0)return!1;const s=Math.floor(r.length/8);return a===r.length||s>0&&a%s===0}},y:{title:"涨跌幅(%)"}},point:{size:1,shape:"circle"},legend:!1,interaction:{tooltip:{render:(t,{title:a,items:r})=>{const s=r.filter(l=>l.name=="rising"&&l.value>0||l.name=="down"&&l.value<0);return e.jsxs("div",{children:[e.jsx("h4",{children:a}),s.map(l=>{const{name:n,value:$,color:k}=l;return e.jsx("div",{children:e.jsxs("div",{style:{margin:0,display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{display:"inline-block",width:6,height:6,borderRadius:"50%",backgroundColor:k,marginRight:6}}),e.jsx("span",{children:n=="rising"?"收涨":"收跌"})]}),e.jsxs("b",{children:[($*100).toFixed(2),"%"]})]})})})]},a)}}}},i=(()=>{if(c.length===0)return null;const t=c.map(s=>s.close),a=c.map(s=>s.pctChg||0),r=c.map(s=>s.volume);return{startPrice:t[0],endPrice:t[t.length-1],minPrice:Math.min(...t),maxPrice:Math.max(...t),avgChange:a.reduce((s,l)=>s+l,0)/a.length,totalVolume:r.reduce((s,l)=>s+l,0),totalAmount:c.reduce((s,l)=>s+l.amount,0),riseDays:a.filter(s=>s>0).length,fallDays:a.filter(s=>s<0).length}})(),D=i?(i.endPrice-i.startPrice)/i.startPrice*100:0;return u.useEffect(()=>{S()},[]),e.jsx("div",{style:{padding:24},children:e.jsxs(I,{title:"股票日线数据分析",variant:"borderless",children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"},children:[e.jsx(w,{value:g,onChange:m,style:{width:200},placeholder:"选择股票代码",loading:F.length===0,children:F.map(t=>e.jsxs(W,{value:t.code,children:[t.name," (",t.code,")"]},t.code))}),e.jsx(U,{value:x,onChange:t=>f(t),disabledDate:t=>t&&t>h().endOf("day")}),e.jsx(b.Group,{value:j,onChange:t=>P(t.target.value),children:e.jsx(b.Button,{value:"2",children:"前复权"})}),e.jsx("button",{onClick:()=>{S()},disabled:p,style:{padding:"8px 16px",backgroundColor:"#1890ff",color:"white",border:"none",borderRadius:"4px",cursor:p?"not-allowed":"pointer",opacity:p?.6:1},children:p?"查询中...":"查询"})]}),p&&e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx(T,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:"日线数据加载中..."})]}),!p&&c.length>0&&e.jsxs("div",{children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{gutter:16,style:{marginBottom:24},children:[e.jsx(o,{span:4,children:e.jsx(d,{title:"期初价格",value:i.startPrice.toFixed(2),suffix:"元"})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"期末价格",value:i.endPrice.toFixed(2),suffix:"元"})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"累计涨跌",value:D.toFixed(2),suffix:"%",valueStyle:{color:D>=0?"#cf1322":"#3f8600"}})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"最高价",value:i.maxPrice.toFixed(2),suffix:"元"})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"最低价",value:i.minPrice.toFixed(2),suffix:"元"})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"平均涨跌",value:i.avgChange.toFixed(2),suffix:"%"})})]}),e.jsxs(C,{gutter:16,style:{marginBottom:24},children:[e.jsx(o,{span:4,children:e.jsx(d,{title:"上涨天数",value:i.riseDays})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"下跌天数",value:i.fallDays})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"总成交量",value:(i.totalVolume/1e4).toFixed(0),suffix:"万股"})}),e.jsx(o,{span:4,children:e.jsx(d,{title:"总成交额",value:(i.totalAmount/1e4).toFixed(0),suffix:"万元"})})]}),e.jsx(O,{})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h3",{children:"价格走势"}),e.jsx(M,{...A})]}),e.jsxs(C,{gutter:24,children:[e.jsxs(o,{span:12,children:[e.jsx("h3",{children:"成交量"}),e.jsx(V,{...B})]}),e.jsxs(o,{span:12,children:[e.jsx("h3",{children:"涨跌幅"}),e.jsx(M,{...H})]})]})]}),!p&&c.length===0&&e.jsx("div",{style:{textAlign:"center",padding:40,color:"#999"},children:"暂无日线数据，请选择股票代码和日期范围后查询"})]})})},ge=E(q);export{ge as default};
