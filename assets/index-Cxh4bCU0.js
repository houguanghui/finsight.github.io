import{w as I,a as d,t}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{c as F,f as S,S as H,R as $,C as p}from"./index-kAgd77-w.js";import{h as B,D as L}from"./request-CjBmveHj.js";import{C as A}from"./index-DFyzaV81.js";import{S as E}from"./index-jC90AlnQ.js";import{I as N}from"./index-DhCLwE81.js";import{S as h,L as z}from"./index-CQDSfuxM.js";import{s as b}from"./index-tUNJ2f8S.js";import"./shadow-Dste9fMo.js";import"./index-C6kagqnf.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./EyeOutlined-BeRCIN0Q.js";import"./TextArea-CJq9T7-C.js";import"./callSuper-YXcpR1nQ.js";import"./useNotification-CCy-DdaB.js";const O="/api/stock-minute",V={getStockMinuteData:async(g,v,f)=>await B.get(`${O}/code/${g}/date-range`,{startDate:v,endDate:f})},{RangePicker:Z}=L,{Option:k}=F,T=()=>{const[g,v]=d.useState("SH"),[f,D]=d.useState("600519"),[m,P]=d.useState([S("2025-09-05"),S("2025-09-05")]),[u,w]=d.useState([]),[l,C]=d.useState(!1);let x=null;const M=`${f}.${g}`,Y=async()=>{var e,i;if(!M||!m[0]||!m[1]){b.warning("请选择股票代码和日期范围");return}C(!0);try{const a=(e=m[0])==null?void 0:e.format("YYYY-MM-DD"),s=(i=m[1])==null?void 0:i.format("YYYY-MM-DD"),[n]=await Promise.all([V.getStockMinuteData(M,a,s)]);w(n)}catch(a){b.error(`数据获取失败: ${a.message}`)}finally{C(!1)}},R={data:(e=>{let i=e.length-1,a=0;return x=e.flatMap((s,n)=>{const r=S(s.time.toString(),"YYYYMMDDHHmmssSSS"),j=r.hour(),o=r.minute(),y=j*60+o;return n==i?[{...s,timeField:r,index:a++}]:[690,900].includes(y)?[{...s,timeField:r,index:a++},{...s,close:NaN,timeField:r.add(5,"minute"),index:a++}]:[{...s,timeField:r,index:a++}]}),x})(u),xField:"index",yField:"close",interaction:{tooltip:{render:(e,{items:i,title:a})=>{const s=i.filter(n=>n.value);return t.jsxs("div",{children:[t.jsx("h4",{children:s[0]?x[parseInt(a)].timeField.format("YYYY年MM月DD日 HH:mm"):"休盘"}),s.map((n,r)=>{const{name:j,value:o,color:y}=n;return t.jsx("div",{children:t.jsxs("div",{style:{margin:0,display:"flex",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("span",{style:{display:"inline-block",width:6,height:6,borderRadius:"50%",backgroundColor:y,marginRight:6}}),t.jsx("span",{children:"收盘价"})]}),t.jsx("b",{children:o.toString()})]})},r)})]},a.toString())}}},axis:{x:{labelFormatter:e=>`${x[e].timeField.hour()}:${x[e].timeField.minute()}`}},legend:!0,connectNulls:{connect:!0,connectStroke:"#aaa"}},c=(()=>{if(u.length===0)return null;const e=u.filter(s=>{const n=s.time.toString().padStart(17,"0"),r=parseInt(n.slice(8,10)),j=parseInt(n.slice(10,12)),o=r*60+j;return o>=570&&o<=690||o>=780&&o<=900});if(e.length===0)return null;const i=e.map(s=>s.close),a=e.map(s=>s.volume);return{minPrice:Math.min(...i),maxPrice:Math.max(...i),avgPrice:i.reduce((s,n)=>s+n,0)/i.length,totalVolume:a.reduce((s,n)=>s+n,0),lastPrice:i[i.length-1]}})();return d.useEffect(()=>{Y()},[]),t.jsx("div",{style:{padding:24},children:t.jsxs(A,{title:"股票分时走势图",variant:"borderless",children:[t.jsxs("div",{style:{marginBottom:24,display:"flex",alignItems:"center",gap:16},children:[t.jsxs(E.Compact,{children:[t.jsxs(F,{value:g,onChange:v,children:[t.jsx(k,{value:"SH",children:"上证 (SH)"}),t.jsx(k,{value:"SZ",children:"深证 (SZ)"})]}),t.jsx(N,{value:f,onChange:e=>D(e.target.value)})]}),t.jsx(Z,{value:m,onChange:e=>P(e),disabledDate:e=>e&&e>S().endOf("day")}),t.jsx("button",{onClick:Y,disabled:l,style:{padding:"8px 16px",backgroundColor:"#1890ff",color:"white",border:"none",borderRadius:"4px",cursor:l?"not-allowed":"pointer",opacity:l?.6:1},children:l?"查询中...":"查询"})]}),l&&t.jsxs("div",{style:{textAlign:"center",padding:40},children:[t.jsx(H,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:"分时数据加载中..."})]}),!l&&u.length>0&&t.jsxs("div",{children:[c&&t.jsxs($,{gutter:16,style:{marginBottom:24},children:[t.jsx(p,{span:4,children:t.jsx(h,{title:"当前价格",value:c.lastPrice.toFixed(2),suffix:"元"})}),t.jsx(p,{span:4,children:t.jsx(h,{title:"最低价",value:c.minPrice.toFixed(2),suffix:"元"})}),t.jsx(p,{span:4,children:t.jsx(h,{title:"最高价",value:c.maxPrice.toFixed(2),suffix:"元"})}),t.jsx(p,{span:4,children:t.jsx(h,{title:"平均价",value:c.avgPrice.toFixed(2),suffix:"元"})}),t.jsx(p,{span:4,children:t.jsx(h,{title:"总成交量",value:(c.totalVolume/1e4).toFixed(0),suffix:"万股"})})]}),t.jsxs("div",{style:{marginBottom:24},children:[t.jsx("h3",{children:"分时走势图"}),t.jsx("div",{style:{color:"#999",fontSize:"12px",marginBottom:8}}),t.jsx(z,{...R})]})]}),!l&&u.length===0&&t.jsx("div",{style:{textAlign:"center",padding:40,color:"#999"},children:"暂无分时数据，请选择股票代码和日期范围后查询"})]})})},xt=I(T);export{xt as default};
