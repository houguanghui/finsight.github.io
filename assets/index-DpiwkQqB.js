import{a as c,R as P,t as e,w as _}from"./chunk-PVWAREVJ-CaeOwHG_.js";import{h as $}from"./request-CjBmveHj.js";import{S as ee,R as I,C as h,T as te}from"./index-kAgd77-w.js";import{P as f}from"./index-BLlS64GR.js";import{A as re}from"./index-Bs4fN4oH.js";import{S as g,L as oe}from"./index-CQDSfuxM.js";import{P as Q}from"./index-DPP3BEpb.js";import{T as D}from"./index-DunuK-Wf.js";import{F as C,a as F,r as G,b as se,P as ae,c as ne}from"./Table-Bz-N3dAz.js";import{S as ie}from"./index-jC90AlnQ.js";import{Q as le,X as j,h as d}from"./shadow-Dste9fMo.js";import{I as ce}from"./index-C6kagqnf.js";import{C as pe}from"./index-CybngSer.js";import{R as de}from"./EyeOutlined-BeRCIN0Q.js";import{a as ue}from"./index-CVy4ob4l.js";import"./createForOfIteratorHelper-S2aNMrNp.js";import"./omit-_PpgVY5T.js";import"./index-IEvJvc0V.js";import"./button-DY33ZuDq.js";import"./index-CRb9OZA9.js";import"./Pagination-BgtA34Dv.js";import"./index-DsuPZzx1.js";import"./index-DSKHKlRI.js";import"./callSuper-YXcpR1nQ.js";import"./index-_fd0fOh9.js";import"./index-B4RzsnZD.js";import"./Table-4OPVbUbL.js";import"./Tree-CIH8SUTX.js";import"./Input-Baj7Qhn8.js";import"./Input-Bp_RZhWN.js";import"./index-tUNJ2f8S.js";import"./useNotification-CCy-DdaB.js";import"./index-C38gChg6.js";import"./index-CeNonjvE.js";import"./index-DhCLwE81.js";import"./TextArea-CJq9T7-C.js";import"./AntdIcon-Dmy0igr9.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},me=function(r,n){return c.createElement(ce,le({},r,{ref:n,icon:he}))},fe=c.forwardRef(me),xe=["proFieldProps","fieldProps"],z="date",ve=P.forwardRef(function(t,r){var n=t.proFieldProps,p=t.fieldProps,l=j(t,xe),u=c.useContext(C);return e.jsx(F,d({ref:r,valueType:z,fieldProps:d({getPopupContainer:u.getPopupContainer},p),proFieldProps:n,filedConfig:{valueType:z,customLightMode:!0}},l))}),ge=["proFieldProps","fieldProps"],V="dateMonth",Pe=P.forwardRef(function(t,r){var n=t.proFieldProps,p=t.fieldProps,l=j(t,ge),u=c.useContext(C);return e.jsx(F,d({ref:r,valueType:V,fieldProps:d({getPopupContainer:u.getPopupContainer},p),proFieldProps:n,filedConfig:{valueType:V,customLightMode:!0}},l))}),Ce=["fieldProps"],Y="dateQuarter",Fe=P.forwardRef(function(t,r){var n=t.fieldProps,p=j(t,Ce),l=c.useContext(C);return e.jsx(F,d({ref:r,valueType:Y,fieldProps:d({getPopupContainer:l.getPopupContainer},n),filedConfig:{valueType:Y,customLightMode:!0}},p))}),je=["proFieldProps","fieldProps"],B="dateWeek",ye=P.forwardRef(function(t,r){var n=t.proFieldProps,p=t.fieldProps,l=j(t,je),u=c.useContext(C);return e.jsx(F,d({ref:r,valueType:B,fieldProps:d({getPopupContainer:u.getPopupContainer},p),proFieldProps:n,filedConfig:{valueType:B,customLightMode:!0}},l))}),we=["proFieldProps","fieldProps"],W="dateYear",Se=P.forwardRef(function(t,r){var n=t.proFieldProps,p=t.fieldProps,l=j(t,we),u=c.useContext(C);return e.jsx(F,d({ref:r,valueType:W,fieldProps:d({getPopupContainer:u.getPopupContainer},p),proFieldProps:n,filedConfig:{valueType:W,customLightMode:!0}},l))}),y=ve;y.Week=ye;y.Month=Pe;y.Quarter=Fe;y.Year=Se;y.displayName="ProFormComponent";var be=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],Te=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],$e=function(r,n){var p=r.fieldProps,l=r.children,u=r.params,v=r.proFieldProps,w=r.mode,m=r.valueEnum,S=r.request,x=r.showSearch,b=r.options,s=j(r,be),O=c.useContext(C);return e.jsx(F,d(d({valueEnum:G(m),request:S,params:u,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:d({options:b,mode:w,showSearch:x,getPopupContainer:O.getPopupContainer},p),ref:n,proFieldProps:v},s),{},{children:l}))},Ie=P.forwardRef(function(t,r){var n=t.fieldProps,p=t.children,l=t.params,u=t.proFieldProps,v=t.mode,w=t.valueEnum,m=t.request,S=t.options,x=j(t,Te),b=d({options:S,mode:v||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),s=c.useContext(C);return e.jsx(F,d(d({valueEnum:G(w),request:m,params:l,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:d({getPopupContainer:s.getPopupContainer},b),ref:r,proFieldProps:u},x),{},{children:p}))}),Re=P.forwardRef($e),Me=Ie,E=Re;E.SearchSelect=Me;E.displayName="ProFormComponent";const R="/api/cash-flow",M={getCashFlowData:async(t,r)=>await $.get(`${R}/${t}`,r),getCashFlowTrend:async(t,r=5)=>await $.get(`${R}/${t}/trend`,{years:r}),compareCashFlow:async t=>await $.post(`${R}/compare`,t),getCashFlowHealth:async(t,r)=>await $.get(`${R}/${t}/health`,{reportDate:r}),getCashFlowQuality:async(t,r)=>await $.get(`${R}/${t}/quality`,{reportDate:r})},Le=()=>{const[t,r]=c.useState(!1),[n,p]=c.useState("600519.SH"),[l,u]=c.useState("2023-12-31"),[v,w]=c.useState([]),[m,S]=c.useState(null),[x,b]=c.useState(null),[s,O]=c.useState(null),[A,N]=c.useState(null),Z=[{label:"贵州茅台 (600519)",value:"600519.SH"}];c.useEffect(()=>{K()},[n,l]);const K=async()=>{r(!0);try{const[a,o,L,k]=await Promise.all([M.getCashFlowData(n,{startDate:"2020-01-01",endDate:"2023-12-31"}),M.getCashFlowHealth(n,l),M.getCashFlowTrend(n,5),M.getCashFlowQuality(n,l)]);w(a),S(o),b(L),O(k)}catch(a){console.error("加载数据失败:",a)}finally{r(!1)}},U=[{title:"报告期",dataIndex:"reportDate",key:"reportDate",width:120,renderText:a=>a||"-"},{title:"报告类型",dataIndex:"reportType",key:"reportType",width:100,renderText:a=>a||"-"},{title:"经营现金流",dataIndex:"netcashOperate",key:"netcashOperate",width:120,render:(a,o)=>e.jsx("span",{style:{color:(o.netcashOperate||0)>=0?"#3f8600":"#cf1322"},children:o.netcashOperate?`¥${o.netcashOperate.toLocaleString()}`:"-"})},{title:"投资现金流",dataIndex:"netcashInvest",key:"netcashInvest",width:120,render:(a,o)=>e.jsx("span",{style:{color:(o.netcashInvest||0)>=0?"#3f8600":"#cf1322"},children:o.netcashInvest?`¥${o.netcashInvest.toLocaleString()}`:"-"})},{title:"筹资现金流",dataIndex:"netcashFinance",key:"netcashFinance",width:120,render:(a,o)=>e.jsx("span",{style:{color:(o.netcashFinance||0)>=0?"#3f8600":"#cf1322"},children:o.netcashFinance?`¥${o.netcashFinance.toLocaleString()}`:"-"})},{title:"现金净增加",dataIndex:"cceAdd",key:"cceAdd",width:120,render:(a,o)=>e.jsx("span",{style:{color:(o.endCce||0)-(o.beginCce||0)>=0?"#3f8600":"#cf1322"},children:(o.endCce||0)-(o.beginCce||0)?`¥${((o.endCce||0)-(o.beginCce||0)).toLocaleString()}`:"-"})},{title:"操作",key:"action",width:80,render:(a,o)=>e.jsxs("a",{onClick:()=>N(o),children:[e.jsx(de,{})," 查看"]})}],i=v[0]||{},X={data:c.useMemo(()=>!x||!x.dates?[]:x.dates.flatMap((a,o)=>{var L,k,H;return[{date:a,category:"经营现金流",value:((L=x.operatingCashFlows)==null?void 0:L[o])||0},{date:a,category:"投资现金流",value:((k=x.investingCashFlows)==null?void 0:k[o])||0},{date:a,category:"筹资现金流",value:((H=x.financingCashFlows)==null?void 0:H[o])||0}]}),[x])||[],xField:"date",yField:"value",seriesField:"category",meta:{value:{alias:"现金流金额"},category:{alias:"现金流类型"}},smooth:!0},J={data:[{type:"经营活动",value:Math.abs(i.netcashOperate||0)},{type:"投资活动",value:Math.abs(i.netcashInvest||0)},{type:"筹资活动",value:Math.abs(i.netcashFinance||0)}].filter(a=>a.value>0),angleField:"value",colorField:"type",radius:.8,label:{text:({type:a,value:o})=>`${a} ${o}`,position:"outside"},interactions:[{type:"element-active"}]},T=(a=>{if(!a)return 0;let o=0;return a.operatingVsProfit&&(o+=25),a.freeCashFlowPositive&&(o+=25),a.cashIncomeRatioGood&&(o+=25),a.reinvestmentRatioGood&&(o+=25),o})(s),q={data:[{type:"优秀指标",value:T},{type:"待改进指标",value:100-T}],angleField:"value",colorField:"type",radius:.8,label:{text:({type:a,value:o})=>`${a} ${o.toFixed(0)}%`,position:"outside"},color:["#52c41a","#ff4d4f"]};return e.jsx(ue,{title:"现金流量表&分析",loading:t,content:e.jsxs(ne,{submitter:!1,layout:"inline",onValuesChange:a=>{a.secucode&&p(a.secucode),a.reportDate&&u(a.reportDate)},initialValues:{secucode:n,reportDate:l},children:[e.jsx(E,{name:"secucode",label:"选择公司",options:Z,width:"md"}),e.jsx(y,{name:"reportDate",label:"报告日期",fieldProps:{format:"YYYY-MM-DD"},width:"md"})]}),children:e.jsxs(ee,{spinning:t,children:[m&&e.jsx(f,{style:{marginBottom:24},children:e.jsx(re,{message:`现金流健康度: ${m.healthLevel} (${m.score}分)`,type:m.score>=80?"success":m.score>=60?"info":m.score>=40?"warning":"error",showIcon:!0,description:m.warnings.length>0?e.jsxs("div",{children:[e.jsx("strong",{children:"风险提示:"}),e.jsx("ul",{children:m.warnings.map((a,o)=>e.jsx("li",{children:a},o))})]}):"现金流状况良好"})}),e.jsx(f,{title:"关键现金流指标",style:{marginBottom:24},children:e.jsxs(I,{gutter:16,children:[e.jsx(h,{span:6,children:e.jsx(g,{title:"经营活动现金流",value:i.netcashOperate||void 0,precision:2,valueStyle:{color:(i.netcashOperate||0)>=0?"#3f8600":"#cf1322"},prefix:(i.netcashOperate||0)>=0?"¥":"-¥"})}),e.jsx(h,{span:6,children:e.jsx(g,{title:"投资活动现金流",value:i.netcashInvest||void 0,precision:2,valueStyle:{color:(i.netcashInvest||0)>=0?"#3f8600":"#cf1322"}})}),e.jsx(h,{span:6,children:e.jsx(g,{title:"筹资活动现金流",value:i.netcashFinance||void 0,precision:2,valueStyle:{color:(i.netcashFinance||0)>=0?"#3f8600":"#cf1322"}})}),e.jsx(h,{span:6,children:e.jsx(g,{title:"自由现金流",value:(i.netcashOperate||0)-(i.constructLongAsset||0),precision:2,valueStyle:{color:(i.netcashOperate||0)-(i.constructLongAsset||0)>=0?"#3f8600":"#cf1322"}})})]})}),e.jsx(te,{items:[{key:"trend",label:"趋势分析",children:e.jsx(f,{children:e.jsx(oe,{...X,height:400})})},{key:"structure",label:"结构分析",children:e.jsxs(I,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(f,{title:"现金流结构",children:e.jsx(Q,{...J,height:300})})}),e.jsx(h,{span:12,children:e.jsx(f,{title:"现金及现金等价物",children:e.jsxs(I,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(g,{title:"期初现金余额",value:i.beginCce||void 0,precision:2,prefix:"¥"})}),e.jsx(h,{span:12,children:e.jsx(g,{title:"期末现金余额",value:i.endCce||void 0,precision:2,prefix:"¥"})}),e.jsx(h,{span:24,style:{marginTop:16},children:e.jsx(g,{title:"现金净增加额",value:(i.endCce||0)-(i.beginCce||0),precision:2,valueStyle:{color:(i.endCce||0)-(i.beginCce||0)>=0?"#3f8600":"#cf1322"},prefix:(i.endCce||0)-(i.beginCce||0)>=0?"¥":"-¥"})})]})})})]})},{key:"quality",label:"质量分析",children:e.jsxs(I,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(f,{title:"现金流质量",children:e.jsxs(I,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsxs(f,{title:"经营现金流质量",bordered:!0,children:[e.jsx(g,{title:"经营现金流",value:s==null?void 0:s.operatingCashFlow,precision:2,valueStyle:{color:((s==null?void 0:s.operatingCashFlow)||0)>=0?"#3f8600":"#cf1322"},prefix:"¥"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(D,{color:s!=null&&s.operatingVsProfit?"green":"red",children:s!=null&&s.operatingVsProfit?"优于净利润":"低于净利润"})})]})}),e.jsx(h,{span:12,children:e.jsxs(f,{title:"自由现金流",bordered:!0,children:[e.jsx(g,{title:"自由现金流",value:s==null?void 0:s.freeCashFlow,precision:2,valueStyle:{color:((s==null?void 0:s.freeCashFlow)||0)>=0?"#3f8600":"#cf1322"},prefix:"¥"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(D,{color:s!=null&&s.freeCashFlowPositive?"green":"red",children:s!=null&&s.freeCashFlowPositive?"正向现金流":"负向现金流"})})]})}),(s==null?void 0:s.cashIncomeRatio)&&e.jsx(h,{span:24,style:{marginTop:16},children:e.jsxs(f,{title:"现金收入质量",bordered:!0,children:[e.jsx(se,{type:"circle",percent:Math.round((s.cashIncomeRatio||0)*100),width:80,status:s.cashIncomeRatioGood?"success":"exception"}),e.jsx("div",{style:{marginTop:16},children:e.jsxs(D,{color:s.cashIncomeRatioGood?"green":"red",children:["现金收入比率: ",(s.cashIncomeRatio*100).toFixed(1),"%"]})})]})})]})})}),e.jsx(h,{span:12,children:e.jsxs(f,{title:"质量评分",children:[e.jsx(Q,{...q,height:300}),e.jsx("div",{style:{textAlign:"center",marginTop:16},children:e.jsx(g,{title:"综合质量评分",value:T,precision:0,suffix:"/100",valueStyle:{color:T>=80?"#3f8600":T>=60?"#faad14":"#cf1322"}})})]})})]})},{key:"comparison",label:"对比分析",children:e.jsx(f,{children:e.jsx(ke,{secucode:n,reportDate:l})})}]}),e.jsx(f,{title:e.jsxs(ie,{children:[e.jsx(fe,{}),"现金流量表数据"]}),style:{marginBottom:24},extra:A&&`当前查看: ${A.reportDate}`,children:e.jsx(ae,{columns:U,dataSource:v,pagination:{pageSize:5,showSizeChanger:!1},search:!1,options:!1,rowKey:"id",size:"small"})})]})})},ke=({secucode:t,reportDate:r})=>{const[n,p]=c.useState([]);c.useEffect(()=>{l()},[t,r]);const l=async()=>{try{const v=await M.compareCashFlow({secucodes:["000001.SZ","000002.SZ","600519.SH"],reportDate:r});p(v.peers||[])}catch(v){console.error("加载对比数据失败:",v)}},u={data:n,xField:"securityNameAbbr",yField:"netcashOperate",label:{textBaseline:"bottom"},meta:{securityNameAbbr:{alias:"公司名称"},netcashOperate:{alias:"经营现金流"}}};return e.jsx(pe,{...u,height:300})},Pt=_(Le);export{Pt as default};
